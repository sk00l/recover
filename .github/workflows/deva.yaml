name: Auto Merge Check

on:
  push:
    branches:
    - devA

jobs:
  merge-check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout the current branch (devA)
      uses: actions/checkout@v4

    - name: Set up Git config
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

    - name: Add remote and fetch main
      run: |
        git remote add origin2 https://github.com/${{ github.repository }}.git
        git fetch origin2 main

    - name: Try merging main into devA
      id: merge
      run: |
        git checkout devA
        if git merge origin2/main --no-edit; then
          echo "Merge successful"
          echo "MERGE_CONFLICT=false" >> $GITHUB_ENV
        else
          echo "Merge conflict detected!"
          echo "MERGE_CONFLICT=true" >> $GITHUB_ENV
        fi

    - name: Handle merge result
      run: |
        if [ "${{ env.MERGE_CONFLICT }}" = "true" ]; then
          echo "❌ Merge conflict detected. Please resolve manually."
          exit 1
        else
          echo "✅ No conflicts. You can safely merge devA into main."
        fi
